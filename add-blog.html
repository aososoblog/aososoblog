<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理画面</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .admin-container {
            max-width: 800px;
            margin: 20px auto;
        }
        .form-control {
            margin-bottom: 15px;
        }
        .admin-header {
            margin-bottom: 30px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <h1 class="admin-header">管理画面</h1>
        <form id="post-form">
            <div class="mb-3">
                <label for="title" class="form-label">タイトル</label>
                <input type="text" id="title" class="form-control" placeholder="タイトルを入力">
            </div>
            <div class="mb-3">
                <label for="body" class="form-label">本文</label>
                <textarea id="body" class="form-control" rows="4" placeholder="本文を入力"></textarea>
            </div>
            <div class="mb-3">
                <label for="image-url" class="form-label">画像リンク</label>
                <input type="url" id="image-url" class="form-control" placeholder="画像URLを入力">
            </div>
            <div class="mb-3">
                <label for="title-image-url" class="form-label">タイトル画像リンク (任意)</label>
                <input type="url" id="title-image-url" class="form-control" placeholder="タイトル画像URLを入力">
            </div>
            <div class="mb-3">
                <label for="tags" class="form-label">タグ</label>
                <input type="text" id="tags" class="form-control" placeholder="タグをカンマ区切りで入力">
            </div>
            <button type="button" id="post-button" class="btn btn-primary">投稿</button>
        </form>
        <hr>
        <h2>投稿一覧</h2>
        <div id="post-list" class="mt-3">
            <!-- 投稿リストがここに表示されます -->
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-database.js"></script>

    <!-- 管理画面用スクリプト -->
    <script>
        // Firebase 初期化
        const firebaseConfig = {
          apiKey: "AIzaSyCY0gTY8HdvhH7ddYsqr7AudE3BFlIyenQ",
          authDomain: "aososo-blog.firebaseapp.com",
          databaseURL: "https://aososo-blog-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "aososo-blog",
          storageBucket: "aososo-blog.firebasestorage.app",
          messagingSenderId: "473316603302",
          appId: "1:473316603302:web:b562b4c72e029f303a4b67",
          measurementId: "G-GEB1NXSTQ6"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database(app);

        document.getElementById('post-button').addEventListener('click', () => {
            const title = document.getElementById('title').value;
            const body = document.getElementById('body').value;
            const imageUrl = document.getElementById('image-url').value;
            const titleImageUrl = document.getElementById('title-image-url').value;
            const tags = document.getElementById('tags').value;
            const timestamp = new Date().toISOString();

            const postData = {
                title,
                body,
                imageUrl,
                titleImageUrl,
                tags,
                timestamp
            };

            database.ref('posts').push(postData).then(() => {
                alert('投稿が成功しました！');
                document.getElementById('post-form').reset();
                loadPosts();
            });
        });

        function loadPosts() {
            database.ref('posts').orderByChild('timestamp').once('value', snapshot => {
                const postList = document.getElementById('post-list');
                postList.innerHTML = '';
                snapshot.forEach(postSnapshot => {
                    const post = postSnapshot.val();
                    const postDiv = document.createElement('div');
                    postDiv.classList.add('card', 'mb-3');
                    postDiv.innerHTML = `
                        <div class="card-body">
                            <h5 class="card-title">${post.title}</h5>
                            <p class="card-text">${post.body}</p>
                            <img src="${post.imageUrl}" alt="Post Image" class="img-fluid mb-3">
                            <p class="text-muted">投稿日時: ${new Date(post.timestamp).toLocaleString()}</p>
                            <button class="btn btn-danger btn-sm" onclick="deletePost('${postSnapshot.key}')">削除</button>
                        </div>
                    `;
                    postList.appendChild(postDiv);
                });
            });
        }

        function deletePost(postId) {
            if (confirm('本当に削除しますか？')) {
                database.ref('posts/' + postId).remove().then(() => {
                    alert('削除が成功しました！');
                    loadPosts();
                });
            }
        }

        // ページロード時に投稿を読み込み
        loadPosts();
    </script>
</body>
</html>
